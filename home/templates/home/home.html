{% extends 'base.html' %}
{% block title %}Home{% endblock %}
{% block body %}

<style>
    /* General */
    h1 { color: white; }
    hr  { color: #b4b4b4; }

    /* Upload form styles */
    .upload-card {
        background-color: rgba(51,55,61,0.79);
        border-radius: 35px;
        font-size: 17px;
        color: white;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255,255,255,0.2);
    }
    .file-input {
        border: 2px solid #7912b4;
        border-radius: 50px;
        background-color: #232325;
        color: white;
        font-size: 17px;
    }
    .send-btn {
        background-color: #7912b4;
        border: 3px solid #7912b4;
        color: white;
        border-radius: 50px;
        width: 300px;
        font-size: 17px;
        transition: 0.3s;
    }
    .send-btn:hover { background-color: white; color: black; }

    /* Output card */
    .output-card {
        border-radius: 10px;
        overflow: hidden;
        margin-top: 20px;
        border: none;
        box-shadow: none;
    }
    .output-header {
        background-color: #f1f1f1;
        padding: 12px 16px;
        font-size: 18px;
        font-weight: normal !important;
        border-bottom: 1px solid #ddd; /* line between header and body */
    }
    .output-body {
        display: flex;
        padding: 0;
        background-color: white;
    }

    /* Sidebar (wide for documentation) */
    .output-sidebar {
        width: 300px;
        background-color: #fafafa;
        border-right: 1px solid #e9e9e9;
        padding: 12px 14px;
        font-size: 14px;
        color: #333;
        line-height: 1.5;
    }

    /* Main content */
    .output-content { flex: 1; padding: 16px; }

    /* Image â€” larger but responsive; no gray border */
    .preview-img {
        width: 100%;
        max-width: 900px;
        height: auto;
        display: block;
        margin: 0 auto 12px;
        object-fit: contain;
        border: none !important;
        box-shadow: none !important;
        background: transparent;
        padding: 0;
        border-radius: 8px;
    }

    .download-link {
        display: inline-block;
        margin-bottom: 12px;
        text-decoration: underline;
        color: #007bff;
    }

    /* Table */
    .table-wrapper { padding: 0; box-shadow: none; background: transparent; }
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    .table thead th {
        background-color: #f1f1f1;
        font-weight: normal !important;
        border: none !important;
    }
    .table td {
        border-top: 1px solid #ddd;   /* line between rows */
    }
    .table th {
        border: none !important;
    }

    /* Responsive */
    @media (max-width: 767px) {
        .output-body { flex-direction: column; }
        .output-sidebar { width: 100%; border-right: none; border-bottom: 1px solid #eee; }
        .preview-img { max-width: 100%; }
    }
</style>

<div class="container py-4">
    <h1 class="mb-3">Home</h1>
    <hr>

    <p style="color: #dadada">Send your files to the HoverNet model. You can send multiple files.</p>

    <div class="card p-3 mb-4 shadow-sm upload-card">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <input type="file" name="images"
                       class="form-control form-control-lg file-input w-100"
                       multiple>
            </div>
            <button type="submit" class="btn btn-lg send-btn">Send</button>
        </form>
    </div>

    {% if file_url %}
    <!-- Output Card -->
    <div class="output-card">
        <div class="output-header">Output</div>

        <div class="output-body">
            <!-- Sidebar -->
            <div class="output-sidebar">
                <h6 style="margin:0 0 8px 0;">Attention!</h6>
                <p style="margin:0 0 8px 0;">
                    This is a HoverNet model that outputs the original image and two output maps:
                    instance map and type prediction map.
                </p>
                <p style="margin:0 0 8px 0;">
                    Instance map shows the instances predicted by the model without type consideration.
                </p><br>
                <p style="margin:0 0 8px 0;">
                    Type prediction map includes the semantic segmentation that shows all same-type
                    instances in the same color. You can see the number of each type of instances in the table.
                    This model can predict 5 classes:
                </p><br>
                <p style="margin:0 0 8px 0;">
                    Neoplastic cells, Inflammatory, Connective/Soft tissue cells, Dead cells, Epithelial
                </p>
                <p style="margin:0 0 8px 0;">
                    You can pass multiple images to the model and see the result in this table.
                </p><br>
            </div>

            <!-- Content -->
            <div class="output-content">
                <!-- Image -->
                <div class="text-center mb-3">
                    <img src="{{ file_url }}" alt="Processed Image" class="preview-img">
                    <div><a href="{{ file_url }}" class="download-link">Download image</a></div>
                </div>

                <!-- Table -->
                <div class="table-wrapper">
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>id</th>
                                    <th style="color: Blue;">Neoplastic cells</th>
                                    <th style="color: red;">Inflammatory</th>
                                    <th style="color: #00a822;">Connective/soft tissue cells</th>
                                    <th style="color: #ffae00;">Dead cells</th>
                                    <th style="color: #a600a6;">Epithelial</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for id, types_num, total in nucleus_data %}
                                <tr>
                                    <td>{{ id }}</td>
                                    {% for num in types_num %}
                                    <td>{{ num }}</td>
                                    {% endfor %}
                                    <td>{{ total }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> <!-- end output-content -->
        </div> <!-- end output-body -->
    </div> <!-- end output-card -->
    {% endif %}
</div>

{% endblock %}
